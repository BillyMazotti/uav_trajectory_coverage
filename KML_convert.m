%% SAVE FILES WITH CONTOUR LAT AND LON DATA

%% SF CONTOUR FROM KMZ --> KML FILE --> COPIED OVER
clear
clc
close all

sf_contour_1 = [-123.0022,37.7033 -123.0035,37.7017 -122.9992,37.7 -122.9981,37.6981 -123.0003,37.6952 -123.0083,37.6975 -123.0117,37.6963 -123.0141,37.6996 -123.0119,37.7006 -123.0075,37.6991 -123.0057,37.7006 -123.0054,37.7037 -123.0022,37.7033];
sf_contour_2 = [-122.5021,37.7065 -122.5081,37.7314 -122.5083,37.7489 -122.5114,37.7594 -122.5122,37.7738 -122.5153,37.7811 -122.5065,37.7893 -122.4923,37.788 -122.4853,37.7906 -122.48,37.8014 -122.4781,37.8121 -122.4741,37.809 -122.4703,37.8094 -122.4642,37.8053 -122.4403,37.8086 -122.4403,37.8072 -122.4382,37.8071 -122.4317,37.8094 -122.4238,37.8069 -122.4202,37.8091 -122.4203,37.8118 -122.4153,37.81 -122.4089,37.8117 -122.4077,37.8098 -122.3999,37.8074 -122.3911,37.7933 -122.3842,37.7872 -122.3864,37.7842 -122.3844,37.7786 -122.3887,37.7775 -122.3803,37.7739 -122.3813,37.7716 -122.3861,37.7722 -122.3857,37.7643 -122.3813,37.7646 -122.3781,37.7611 -122.3806,37.7589 -122.3822,37.7539 -122.3792,37.7525 -122.3767,37.7533 -122.3749,37.7458 -122.3711,37.7456 -122.3675,37.7417 -122.368,37.7393 -122.3726,37.7391 -122.3719,37.7375 -122.3747,37.7358 -122.3742,37.7339 -122.3661,37.7331 -122.3569,37.7294 -122.3572,37.7267 -122.3617,37.7239 -122.3581,37.7189 -122.3594,37.7175 -122.3612,37.7184 -122.3633,37.7156 -122.3747,37.7194 -122.3778,37.7236 -122.3819,37.7211 -122.3819,37.7189 -122.3764,37.7158 -122.3797,37.7111 -122.3749,37.7079 -122.3875,37.7089 -122.5021,37.7065];
sf_contour_3 = [-122.3722,37.8319 -122.3677,37.83 -122.363,37.8208 -122.3611,37.8202 -122.3689,37.8164 -122.3702,37.8144 -122.3669,37.8115 -122.3605,37.8132 -122.3618,37.807 -122.3724,37.8101 -122.3712,37.8148 -122.3791,37.8269 -122.3777,37.8304 -122.3722,37.8319];
sf_contour_4 = [-122.4221,37.8248 -122.424,37.8261 -122.4249,37.8279 -122.4203,37.8263 -122.4221,37.8248]';

S(1).xy = KML2SHAPE(sf_contour_1);
S(2).xy = KML2SHAPE(sf_contour_2);
S(3).xy = KML2SHAPE(sf_contour_3); 
S(4).xy = KML2SHAPE(sf_contour_4); 

%%

% Save individual contours
S_out = struct;
% select which contour indexes to save
idx_list = 1:4;
idx_list([1,3,4]) = [];
out_idx = 1;
for idx = idx_list
    S_out(out_idx).contour = S(idx).xy;
    out_idx = out_idx + 1;
end
% save to desired output filepath
outputFilePath = 'FormattedDatasets/SF_formatted/SF_border.mat'
save(outputFilePath,'S_out');


% save convex contour
xy_all = [];
for idx = idx_list
    xy_all = [xy_all;S(idx).xy];
end
k = convhull(xy_all);
convex_contour = [xy_all(k,1),xy_all(k,2)];
S_out = struct
S_out.contour = convex_contour;
outputFilePath = 'FormattedDatasets/SF_formatted/SF_border_convex.mat'
save(outputFilePath,'S_out');


figure(1)
hold on
% selecte which contour indexes to see
for idx = idx_list
    plot(S(idx).xy(:,1),S(idx).xy(:,2))
end
plot(convex_contour(:,1),convex_contour(:,2));
hold off
axis equal


%% NYC CONTOUR FROM KMZ --> KML --> COPIED OVER
clear
clc
close all

% long island
NYC_contour_1_1 = [-74.0844,40.6486 -74.071,40.644 -74.0704,40.6414 -74.0727,40.6387 -74.0706,40.6372 -74.0739,40.6339 -74.0684,40.6292 -74.072,40.6269 -74.0717,40.6239 -74.0696,40.6208 -74.0658,40.6203 -74.0554,40.6062 -74.0553,40.6031 -74.0527,40.6014 -74.0751,40.5793 -74.0897,40.5688 -74.1051,40.5538 -74.1091,40.5526 -74.113,40.5477 -74.1155,40.5478 -74.1238,40.543 -74.1356,40.5301 -74.1394,40.5316 -74.1403,40.5339 -74.1386,40.5353 -74.1343,40.5348 -74.1281,40.5411 -74.1286,40.5449 -74.1316,40.5466 -74.1364,40.5457 -74.1422,40.5397 -74.1419,40.5372 -74.1468,40.5354 -74.1559,40.5279 -74.1619,40.5272 -74.1778,40.5195 -74.181,40.5203 -74.1856,40.5188 -74.1947,40.5103 -74.1999,40.512 -74.2074,40.5116 -74.2182,40.5028 -74.2303,40.5019 -74.2368,40.4997 -74.2379,40.4979 -74.2463,40.4963 -74.2516,40.4981 -74.2558,40.5075 -74.2492,40.5178 -74.2436,40.5186 -74.2419,40.5203 -74.2439,40.5292 -74.2419,40.5306 -74.2425,40.535 -74.2458,40.5417 -74.2486,40.5439 -74.2436,40.5481 -74.2397,40.5481 -74.2306,40.5561 -74.2164,40.5572 -74.2117,40.5614 -74.2097,40.5692 -74.1994,40.5735 -74.1988,40.5781 -74.1971,40.5787 -74.1913,40.5761 -74.1825,40.5763 -74.1786,40.5792 -74.1811,40.5853 -74.1749,40.5906 -74.1794,40.5894 -74.1804,40.5913 -74.1786,40.5945 -74.1816,40.5918 -74.1806,40.5881 -74.1831,40.5853 -74.18,40.5803 -74.1819,40.5779 -74.1871,40.5787 -74.1915,40.5773 -74.1967,40.5799 -74.2058,40.58 -74.205,40.5892 -74.1975,40.5975 -74.1967,40.6039 -74.1983,40.6081 -74.1958,40.6128 -74.1969,40.6158 -74.2008,40.6175 -74.2019,40.6289 -74.1919,40.6397 -74.1864,40.6436 -74.18,40.6453 -74.1783,40.6428 -74.1733,40.6447 -74.1706,40.6422 -74.1689,40.6444 -74.1572,40.6389 -74.145,40.6392 -74.135,40.6419 -74.1289,40.6417 -74.1253,40.6394 -74.1219,40.6419 -74.1097,40.6456 -74.0989,40.645 -74.0844,40.6486];
NYC_contour_1_2 = [-74.0531,40.5793 -74.0532,40.5776 -74.0544,40.577 -74.055,40.5798 -74.0531,40.5793];
NYC_contour_1_3 = [-74.2034,40.5736 -74.2067,40.5739 -74.2075,40.5753 -74.2064,40.5781 -74.2016,40.579 -74.2009,40.5753 -74.2034,40.5736];
NYC_contour_1_4 = [-74.1989,40.6039 -74.2019,40.6056 -74.2031,40.6083 -74.2011,40.6136 -74.1986,40.6128 -74.2003,40.6088 -74.1989,40.6039];
NYC_contour_1_5 = [-74.1586,40.6447 -74.1575,40.6433 -74.1592,40.6414 -74.1617,40.6422 -74.1614,40.6447 -74.1586,40.6447];

% brooklyn
NYC_contour_2_1 = [-73.865,40.6272 -73.8669,40.6242 -73.8656,40.6214 -73.8669,40.6178 -73.8761,40.6153 -73.8794,40.6164 -73.8797,40.6197 -73.8781,40.6217 -73.8681,40.6278 -73.865,40.6272];
NYC_contour_2_2 = [-73.8564,40.6517 -73.8581,40.6519 -73.857,40.6445 -73.858,40.6433 -73.8671,40.6396 -73.8723,40.6448 -73.8681,40.6376 -73.8739,40.6359 -73.8781,40.6383 -73.8781,40.6351 -73.884,40.6311 -73.8833,40.6272 -73.8887,40.6285 -73.897,40.6237 -73.9069,40.6272 -73.9108,40.6311 -73.9143,40.6304 -73.9128,40.6275 -73.8967,40.6213 -73.8955,40.6155 -73.8892,40.612 -73.894,40.607 -73.8989,40.605 -73.9071,40.6055 -73.9095,40.6028 -73.8825,40.6047 -73.8804,40.5945 -73.8761,40.5847 -73.8797,40.5793 -73.8861,40.5778 -73.8954,40.577 -73.8977,40.5796 -73.8964,40.5828 -73.8986,40.586 -73.9011,40.5853 -73.9067,40.5869 -73.9117,40.5847 -73.9106,40.5819 -73.9131,40.5806 -73.9176,40.5828 -73.9194,40.5817 -73.9284,40.5836 -73.9323,40.5821 -73.9486,40.5829 -73.9425,40.5808 -73.9327,40.581 -73.9311,40.5769 -73.9319,40.5753 -73.9444,40.5758 -73.9514,40.5737 -73.957,40.5749 -73.9817,40.5712 -73.9959,40.5708 -74.0111,40.5739 -74.0131,40.5776 -74.0103,40.5802 -74.004,40.5814 -73.992,40.5794 -73.9911,40.5814 -73.9995,40.5833 -73.9997,40.5928 -74.01,40.6005 -74.0295,40.6045 -74.0335,40.6068 -74.04,40.6145 -74.0399,40.6181 -74.0416,40.6212 -74.042,40.6284 -74.0376,40.6368 -74.038,40.6399 -74.034,40.6443 -74.027,40.6454 -74.0278,40.6479 -74.0264,40.6519 -74.0207,40.6572 -74.013,40.661 -74.0086,40.6597 -74.0099,40.6622 -74.0045,40.6658 -74.0092,40.6689 -74.0122,40.6644 -74.0167,40.6647 -74.0183,40.6669 -74.0183,40.6711 -74.0156,40.6661 -74.013,40.6664 -74.02,40.6769 -74.0194,40.6797 -74.0128,40.6839 -74.0108,40.6872 -74.0092,40.6867 -74.0033,40.6938 -73.9997,40.6953 -73.9984,40.7014 -73.9942,40.7047 -73.9915,40.7036 -73.9789,40.706 -73.9752,40.7024 -73.9728,40.7025 -73.9734,40.7077 -73.9724,40.7068 -73.9722,40.7089 -73.97,40.7072 -73.97,40.71 -73.96,40.7188 -73.954,40.7396 -73.9468,40.7381 -73.9241,40.7233 -73.9236,40.7174 -73.9195,40.7105 -73.8987,40.693 -73.8958,40.6862 -73.8861,40.6838 -73.869,40.6927 -73.8538,40.6671 -73.8601,40.6581 -73.855,40.6511 -73.8564,40.6517];
NYC_contour_2_3 = [-74.0136,40.6928 -74.0122,40.6889 -74.0139,40.6872 -74.0206,40.6842 -74.0256,40.6847 -74.0247,40.6878 -74.0194,40.6925 -74.0136,40.6928];

% manhattan
NYC_contour_3_1 = [-73.9866,40.7938 -73.97,40.8164 -73.9358,40.8786 -73.9128,40.8738 -73.9105,40.8697 -73.9112,40.8651 -73.9237,40.849 -73.9288,40.839 -73.9328,40.821 -73.9295,40.8078 -73.9212,40.8009 -73.9269,40.7961 -73.9281,40.7986 -73.9297,40.7947 -73.936,40.7908 -73.9385,40.7858 -73.9444,40.7823 -73.9421,40.7751 -73.9619,40.7555 -73.9717,40.7433 -73.9744,40.7331 -73.9717,40.7264 -73.9769,40.7114 -73.9821,40.7095 -73.9943,40.709 -74.0,40.7063 -74.0003,40.7073 -74.0011,40.7049 -74.0052,40.7023 -74.0155,40.7009 -74.02,40.706 -74.0175,40.7153 -74.0243,40.7144 -74.013,40.759 -73.9866,40.7938];

% the bronx
NYC_contour_4_1 = [-73.7842,40.8519 -73.7807,40.8485 -73.7819,40.8445 -73.7792,40.8439 -73.7828,40.8364 -73.7856,40.8367 -73.7902,40.8433 -73.7919,40.8472 -73.7903,40.85 -73.7924,40.8568 -73.7897,40.8589 -73.7866,40.8527 -73.7842,40.8519];
NYC_contour_4_2 = [-73.7694,40.8456 -73.7717,40.8478 -73.7722,40.8519 -73.7725,40.8597 -73.7714,40.8603 -73.7644,40.8553 -73.7689,40.8533 -73.7694,40.8483 -73.7678,40.8453 -73.7694,40.8456];
NYC_contour_4_3 = [-73.8994,40.7989 -73.9006,40.7997 -73.8997,40.8019 -73.8969,40.8019 -73.8994,40.7989];
NYC_contour_4_4 = [-73.9322,40.8862 -73.9172,40.9201 -73.8593,40.9008 -73.8543,40.9066 -73.8417,40.9019 -73.8322,40.8918 -73.7927,40.8828 -73.7958,40.8769 -73.8047,40.8678 -73.8022,40.8661 -73.7986,40.8717 -73.7939,40.8752 -73.7945,40.8774 -73.7929,40.8798 -73.7898,40.8811 -73.789,40.8791 -73.7847,40.8786 -73.7836,40.8775 -73.7869,40.8733 -73.7833,40.8742 -73.7828,40.8711 -73.7925,40.8672 -73.7917,40.8622 -73.7977,40.8547 -73.7978,40.8513 -73.8003,40.8478 -73.8047,40.8536 -73.8038,40.8564 -73.8053,40.8615 -73.8075,40.8594 -73.8142,40.8628 -73.8161,40.8661 -73.8144,40.8678 -73.8155,40.8694 -73.82,40.8692 -73.8222,40.8706 -73.8194,40.8817 -73.82,40.8847 -73.8236,40.8736 -73.8233,40.8697 -73.82,40.8678 -73.8197,40.8625 -73.8153,40.8619 -73.8128,40.8597 -73.8123,40.8551 -73.8169,40.8522 -73.8154,40.8489 -73.816,40.8463 -73.8132,40.8448 -73.8139,40.8431 -73.8164,40.8433 -73.8143,40.8391 -73.8163,40.8378 -73.8154,40.8329 -73.8125,40.8281 -73.813,40.8258 -73.8119,40.8246 -73.8072,40.8256 -73.8047,40.8192 -73.7975,40.8164 -73.8017,40.8126 -73.8058,40.8156 -73.8044,40.8119 -73.7942,40.8072 -73.7909,40.8072 -73.7901,40.8052 -73.7947,40.8039 -73.8094,40.8125 -73.8181,40.8136 -73.8305,40.8105 -73.8322,40.8048 -73.8342,40.8044 -73.8378,40.8068 -73.8404,40.8114 -73.84,40.8195 -73.8454,40.8109 -73.8493,40.8098 -73.8475,40.8063 -73.8487,40.8043 -73.8573,40.805 -73.8603,40.8092 -73.8679,40.8108 -73.8708,40.8142 -73.8717,40.8133 -73.8681,40.8075 -73.8728,40.7975 -73.8803,40.8022 -73.8842,40.8018 -73.8885,40.8044 -73.8971,40.8058 -73.9041,40.8027 -73.9099,40.7964 -73.9139,40.7964 -73.915,40.7917 -73.9239,40.7828 -73.9289,40.7817 -73.9342,40.7831 -73.9358,40.7844 -73.9346,40.7875 -73.9281,40.7917 -73.9269,40.7961 -73.9212,40.8009 -73.9295,40.8078 -73.9328,40.821 -73.9288,40.839 -73.9237,40.849 -73.9112,40.8651 -73.9105,40.8697 -73.9128,40.8738 -73.9358,40.8786 -73.9322,40.8862];
NYC_contour_4_5 = [-73.7842,40.8597 -73.7848,40.8587 -73.7875,40.8585 -73.7858,40.8608 -73.7842,40.8597];

% queens
NYC_contour_5_1 = [-73.744,40.6102 -73.7425,40.6084 -73.7438,40.6075 -73.7372,40.6015 -73.7374,40.594 -73.7461,40.5947 -73.7536,40.5912 -73.7729,40.5905 -73.7956,40.5856 -73.8211,40.5822 -73.8745,40.5629 -73.8994,40.5561 -73.9044,40.5569 -73.908,40.5558 -73.941,40.5422 -73.9392,40.5553 -73.9314,40.5581 -73.9266,40.5617 -73.9189,40.562 -73.9108,40.5653 -73.9058,40.5628 -73.9005,40.5635 -73.8947,40.5681 -73.8792,40.569 -73.8708,40.5717 -73.8519,40.5817 -73.84,40.5817 -73.8235,40.5878 -73.8207,40.5868 -73.8192,40.5892 -73.8156,40.5892 -73.8122,40.5923 -73.8049,40.5954 -73.8056,40.5972 -73.8028,40.5992 -73.7947,40.5992 -73.7867,40.6039 -73.7858,40.6031 -73.79,40.5994 -73.7909,40.5964 -73.7897,40.5959 -73.7836,40.6028 -73.7831,40.6064 -73.778,40.61 -73.7748,40.6096 -73.7739,40.6058 -73.7761,40.6022 -73.7822,40.5981 -73.7781,40.5983 -73.7756,40.6014 -73.7733,40.5983 -73.7716,40.5984 -73.7689,40.6092 -73.7736,40.6111 -73.7731,40.6138 -73.7656,40.6142 -73.7633,40.6114 -73.7583,40.61 -73.7455,40.6121 -73.744,40.6102];
NYC_contour_5_2 = [-73.856,40.6023 -73.8531,40.6022 -73.8508,40.6 -73.8522,40.5972 -73.8586,40.5956 -73.8631,40.5986 -73.8633,40.6008 -73.8617,40.6022 -73.856,40.6023];
NYC_contour_5_3 = [-73.8379,40.6121 -73.8407,40.6044 -73.8473,40.6036 -73.849,40.6069 -73.8465,40.6079 -73.8463,40.614 -73.8379,40.6121];
NYC_contour_5_4 = [-73.8494,40.6125 -73.8492,40.61 -73.8542,40.6061 -73.8567,40.6103 -73.8514,40.6131 -73.8494,40.6125];
NYC_contour_5_5 = [-73.7969,40.6094 -73.7933,40.6067 -73.7967,40.6039 -73.8044,40.605 -73.8047,40.6067 -73.802,40.6095 -73.7969,40.6094];
NYC_contour_5_6 = [-73.8324,40.6052 -73.8356,40.605 -73.8358,40.6061 -73.8328,40.61 -73.8301,40.6086 -73.8301,40.606 -73.8324,40.6052];
NYC_contour_5_7 = [-73.8261,40.6058 -73.8286,40.6056 -73.8272,40.6081 -73.8283,40.6097 -73.8248,40.6059 -73.8261,40.6058];
NYC_contour_5_8 = [-73.8219,40.6347 -73.8206,40.6286 -73.8181,40.6261 -73.8188,40.6228 -73.8156,40.6211 -73.8166,40.6186 -73.8147,40.6067 -73.8095,40.6001 -73.8132,40.5992 -73.8156,40.6051 -73.8178,40.6033 -73.8206,40.5944 -73.8344,40.595 -73.8322,40.5931 -73.8319,40.59 -73.8331,40.5886 -73.8369,40.5892 -73.8431,40.5922 -73.8436,40.5947 -73.8405,40.5966 -73.8283,40.5975 -73.8197,40.61 -73.8208,40.6119 -73.8231,40.6103 -73.8258,40.6142 -73.8378,40.6153 -73.8347,40.6228 -73.8317,40.6256 -73.8328,40.6275 -73.8317,40.6333 -73.8339,40.6383 -73.8322,40.6392 -73.8253,40.6362 -73.8242,40.6408 -73.8219,40.6347];
NYC_contour_5_9 = [-73.7981,40.6253 -73.8017,40.6231 -73.8028,40.6208 -73.8017,40.6184 -73.8036,40.6154 -73.8064,40.6225 -73.8008,40.6264 -73.7981,40.6253];
NYC_contour_5_10 = [-73.8125,40.625 -73.8136,40.6241 -73.8144,40.6256 -73.8122,40.6267 -73.8125,40.625];
NYC_contour_5_11 = [-73.8539,40.6672 -73.869,40.6927 -73.8861,40.6838 -73.8958,40.6862 -73.8987,40.693 -73.9195,40.7105 -73.9236,40.7174 -73.9241,40.7233 -73.9468,40.7381 -73.954,40.7396 -73.96,40.7188 -73.9697,40.7102 -73.9672,40.7184 -73.9627,40.7231 -73.9606,40.7442 -73.9427,40.7659 -73.936,40.7698 -73.938,40.7736 -73.936,40.7775 -73.9286,40.7767 -73.9178,40.784 -73.913,40.7897 -73.9089,40.7911 -73.9026,40.7898 -73.8954,40.7857 -73.8912,40.7817 -73.8897,40.7748 -73.8873,40.7739 -73.8848,40.7759 -73.8851,40.7801 -73.8811,40.78 -73.8786,40.7831 -73.875,40.7819 -73.8717,40.7858 -73.8792,40.785 -73.8892,40.7878 -73.8928,40.7933 -73.8925,40.7967 -73.8883,40.7989 -73.8831,40.7953 -73.8764,40.7936 -73.8719,40.7911 -73.8706,40.7883 -73.8683,40.7881 -73.8705,40.7821 -73.8697,40.7792 -73.8554,40.7714 -73.8575,40.7675 -73.861,40.766 -73.8606,40.7642 -73.8565,40.7645 -73.8537,40.7611 -73.8476,40.7609 -73.8434,40.7643 -73.8504,40.7701 -73.8492,40.776 -73.8522,40.7806 -73.8508,40.7819 -73.8536,40.7814 -73.8594,40.7853 -73.8549,40.788 -73.8533,40.7949 -73.8503,40.7937 -73.847,40.796 -73.8393,40.7973 -73.8364,40.7932 -73.8368,40.7897 -73.8331,40.7886 -73.8284,40.7928 -73.8292,40.7967 -73.8244,40.7977 -73.8198,40.801 -73.8112,40.7975 -73.7953,40.7956 -73.7943,40.7896 -73.7927,40.7888 -73.7903,40.7905 -73.7825,40.7907 -73.781,40.7928 -73.7822,40.7953 -73.7788,40.797 -73.7759,40.7962 -73.7726,40.7924 -73.7707,40.7881 -73.774,40.7861 -73.7682,40.7799 -73.7656,40.7739 -73.7575,40.7669 -73.7551,40.7671 -73.7558,40.7711 -73.7536,40.7736 -73.7554,40.7766 -73.7536,40.7808 -73.7508,40.7827 -73.7481,40.7806 -73.7467,40.7813 -73.7056,40.7499 -73.7042,40.7358 -73.7288,40.7239 -73.7267,40.7103 -73.7251,40.6517 -73.741,40.647 -73.7449,40.6358 -73.7461,40.6367 -73.7531,40.6328 -73.7669,40.6283 -73.7703,40.6197 -73.7742,40.6208 -73.7728,40.6238 -73.7747,40.6259 -73.7798,40.6261 -73.7843,40.6199 -73.7809,40.6139 -73.79,40.6081 -73.8011,40.6119 -73.7944,40.6229 -73.7889,40.6233 -73.7833,40.6289 -73.7853,40.6314 -73.8196,40.6465 -73.8231,40.6522 -73.8228,40.6583 -73.825,40.6556 -73.8239,40.6489 -73.8288,40.6488 -73.8311,40.6514 -73.8309,40.6491 -73.8356,40.6478 -73.8369,40.6447 -73.8495,40.6443 -73.8522,40.6469 -73.8511,40.6503 -73.8547,40.6508 -73.8601,40.6581 -73.8539,40.6672];
NYC_contour_5_12 = [-73.8474,40.6363 -73.8483,40.6372 -73.8471,40.6384 -73.8465,40.637 -73.8474,40.6363];
NYC_contour_5_13 = [-73.9411,40.7697 -73.9528,40.7581 -73.9529,40.7562 -73.9616,40.7496 -73.9442,40.7703 -73.9408,40.7717 -73.9411,40.7697];
NYC_contour_5_14 = [-73.897,40.7958 -73.8971,40.7955 -73.8992,40.7964 -73.8974,40.797 -73.897,40.7958];

S(1).xy = KML2SHAPE(NYC_contour_1_1);
S(2).xy = KML2SHAPE(NYC_contour_1_2);
S(3).xy = KML2SHAPE(NYC_contour_1_3);
S(4).xy = KML2SHAPE(NYC_contour_1_4);
S(5).xy = KML2SHAPE(NYC_contour_1_5);

S(6).xy = KML2SHAPE(NYC_contour_2_1);
S(7).xy = KML2SHAPE(NYC_contour_2_2);
S(8).xy = KML2SHAPE(NYC_contour_2_3);

S(9).xy = KML2SHAPE(NYC_contour_3_1);

S(10).xy = KML2SHAPE(NYC_contour_4_1);
S(11).xy= KML2SHAPE(NYC_contour_4_2);
S(12).xy= KML2SHAPE(NYC_contour_4_3);
S(13).xy = KML2SHAPE(NYC_contour_4_4);
S(14).xy = KML2SHAPE(NYC_contour_4_5);

S(15).xy = KML2SHAPE(NYC_contour_5_1);
S(16).xy = KML2SHAPE(NYC_contour_5_2);
S(17).xy = KML2SHAPE(NYC_contour_5_3);
S(18).xy = KML2SHAPE(NYC_contour_5_4);
S(19).xy = KML2SHAPE(NYC_contour_5_5);
S(20).xy = KML2SHAPE(NYC_contour_5_6);
S(21).xy = KML2SHAPE(NYC_contour_5_7);
S(22).xy = KML2SHAPE(NYC_contour_5_8);
S(23).xy = KML2SHAPE(NYC_contour_5_9);
S(24).xy = KML2SHAPE(NYC_contour_5_10);
S(25).xy = KML2SHAPE(NYC_contour_5_11);
S(26).xy = KML2SHAPE(NYC_contour_5_12);
S(27).xy = KML2SHAPE(NYC_contour_5_13);
S(28).xy = KML2SHAPE(NYC_contour_5_14);

%%
% Save individual contours
% S_out = struct;
% select which contour indexes to save

% NYC selections
idx_list = 1:1:28;
idx_list([2:5,6,8,10:12,14:24,26:end]) = []

% out_idx = 1;
% for idx = idx_list
%     S_out(out_idx).contour = S(idx).xy;
%     out_idx = out_idx + 1;
% end
% save to desired output filepath
% outputFilePath = 'FormattedDatasets/NYC_formatted/NYC_border.mat'
% save(outputFilePath,'S_out');

% create convex contour
xy_all = [];
for idx = idx_list
    xy_all = [xy_all;S(idx).xy];
end
k = convhull(xy_all);
convex_contour = [xy_all(k,1),xy_all(k,2)];
% S_out = struct
% S_out.contour = convex_contour;
% outputFilePath = 'FormattedDatasets/NYC_formatted/NYC_border_convex.mat'
% save(outputFilePath,'S_out');



figure
hold on
% selecte which contour indexes to see

for idx = idx_list
    plot(S(idx).xy(:,1),S(idx).xy(:,2))
end
plot(convex_contour(:,1),convex_contour(:,2));
hold off
axis equal

%% Select and view contours
close all
% select which contour indexes to view
% NYC
idx_list = 1:1:28;  % all contours
idx_list = [1,7,9,13,25]  % selected contours (comment to view all contours)
%SF
idx_list = 1:4;
idx_list = 2;


% create convex contour
xy_all = [];
for idx = idx_list
    xy_all = [xy_all;S(idx).xy];
end
k = convhull(xy_all);
convex_contour = [xy_all(k,1),xy_all(k,2)];

% view currect contour selections
figure
hold on
% selecte which contour indexes to see

for idx = idx_list
    plot(S(idx).xy(:,1),S(idx).xy(:,2),'k')
    text(mean(S(idx).xy(:,1)),mean(S(idx).xy(:,2)),num2str(idx))
end
plot(convex_contour(:,1),convex_contour(:,2),'r');
xlabel('Longitude [deg]')
ylabel('Lattitude [deg]')
axis equal
legend('City Contours','Convex Contour')
hold off

%% View Saved Contour and Convex Plots

close all
clear
clc

city = "SF";

switch city
    case "LA"
        loadfile_1 = load('FormattedDatasets/LA_formatted/LA_border.mat');
        loadfile_2 = load('FormattedDatasets/LA_formatted/LA_border_convex.mat');
    case "NYC"
        loadfile_1 = load('FormattedDatasets/NYC_formatted/NYC_border.mat');
        loadfile_2 = load('FormattedDatasets/NYC_formatted/NYC_border_convex.mat');
    case "SF"
        loadfile_1 = load('FormattedDatasets/SF_formatted/SF_border.mat');
        loadfile_2 = load('FormattedDatasets/SF_formatted/SF_border_convex.mat');
end

S1 = loadfile_1.S_out;
S2 = loadfile_2.S_out;

figure
hold on
for idx = 1:1:size(S1,2)
    plot(S1(idx).contour(:,1),S1(idx).contour(:,2),'k')
end
plot(S2.contour(:,1),S2.contour(:,2),'r')
sgtitle(city)
xlabel('Longitude [deg]')
ylabel('Lattitude [deg]')
axis equal
legend('City Contours','Convex Contour')
hold off

%% FUNCTIONS

function xy_coords = KML2SHAPE(contour)
    minX_map_lat = -130;
    minY_map_long = 0;
    lat2meters = 10000000/90;
    long2meters = 40075161.2/360;
    minX_map_m = minX_map_lat * lat2meters;
    minY_map_m = minY_map_long * long2meters;

    xy_coords = zeros(length(contour)/2,2);
    xy_index = 1:1:length(contour);
%     xy_coords(:,1) = contour(mod(xy_index,2)==1)*lat2meters - minX_map_m;
%     xy_coords(:,2) = contour(mod(xy_index,2)==0)*long2meters - minY_map_m;
    xy_coords(:,1) = contour(mod(xy_index,2)==1);
    xy_coords(:,2) = contour(mod(xy_index,2)==0);

end
